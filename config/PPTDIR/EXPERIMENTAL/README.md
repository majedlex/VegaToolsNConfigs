# WARNING!!!--- This section is EXPERMENTAL ONLY!!! I only have limited set of Vega56/64/FE gpus to test with.  Use it at YOUR OWN RISK. ---WARNING!!!


NOTE: This PPT generating script assumes mV values for memory P states can be found in any of the 8 mV values of GPU voltage table(P0-P7 under OD_SCLK).  PPT text generation will fail if memory mV values are not in the first 8 mV values.  The PPT values generated by the script may not work in Windows.

Example:

    VALID
        s 0 852 862
        s 1 991 862
        s 2 1084 900
        s 3 1138 862
        s 4 1050 862
        s 5 1202 861
        s 6 1212 862
        s 7 1270 862
        m 0 167 861 <-- this value can be found in "s 5" mV value 
        m 1 500 900 <-- this value can be found in "s 2" mV value 
        m 2 700 862 <-- this value can be found in "s 0" mV value
        m 3 900 900 <-- this value can be found in "s 2" mV value 
        
    INVALID
        s 0 852 862
        s 1 991 862
        s 2 1084 900
        s 3 1138 862
        s 4 1050 862
        s 5 1202 861
        s 6 1212 862
        s 7 1270 862
        m 0 167 888 <-- this value can't be found in any of "s 0" - "s 7" mV values 
        m 1 500 900 <-- this value can be found in "s 2" mV value 
        m 2 700 862 <-- this value can be found in "s 0" mV value
        m 3 900 900 <-- this value can be found in "s 2" mV value 


The V56PPTTemplate and  V64PPTTemplate files are included in the directory. The V64PPTTemplate can be used for Vega FE.
You can also use your own default file by using xxd.

$ xxd -ps -c 1500 /sys/class/drm/card0/device/pp_table > MyV56TemplateFile

Then add the C0c0a0, V0v0, C1c1a1, V1v1, C2c2a2, V2v2, C3c3a3, V3v3, C4c4a4, V4v4, C5c5a5, V5v5, C6c6a6, V6v6, C7c7a7, V7v7, M0m0a0, M1m1a1, I1i1, M2m2a2, I2i2, M3m3a3, I3i3 values to MyV56TemplateFile at the correct offset by looking at the provided V56PPTTemplate and/or V64PPTTemplate file(s).

In this example, Vega56 is being used.  Vega FE and 64 usages are similar. 
First check your base/default clock speed and content of your settings assuming you have read/write access to your graphics card.
If not, set up the system according to any of the guide files in this site.
If you do not have base template, get one from your system by running the following command.

Assuming the card0 is the the gpu that you want to modify the PPT.

    $ cat /sys/class/drm/card0/device/pp_od_clk_voltage
        OD_SCLK:
        0:        852Mhz        840mV
        1:        991Mhz        840mV
        2:       1084Mhz        840mV
        3:       1138Mhz        840mV
        4:       1150Mhz        840mV
        5:       1202Mhz        840mV
        6:       1212Mhz        840mV
        7:       1408Mhz        840mV
        OD_MCLK:
        0:        167Mhz        840mV
        1:        500Mhz        840mV
        2:        800Mhz        840mV
        3:       1050Mhz        840mV
        OD_RANGE:
        SCLK:     852MHz       2400MHz
        MCLK:     167MHz       1500MHz
        VDDC:     800mV        1200mV

Edit and create a file similar to the one below.

To avoid confusion on many PPT files, use the following file name.

        VXXSMCLKssssMmmmVvvvPPxxxTT
        VXX - Vega 56, 64 or FE
        SMCLK - SMClock
        ssss - P7 core clock number
        M - Start of mem
        mmm - P3 memory clock number
        V - Start of mV
        vvv - P3 mV value
        PP - Start of power percentage
        xxx - power percentage number usually 50-150
        TT - Memory type HX for Hynix, SS for Samsung

    $ cat V56SMCLK1270M900V862PP75HX
        s 0 852 862
        s 1 991 862
        s 2 1084 862 
        s 3 1138 862
        s 4 1050 862
        s 5 1202 862
        s 6 1212 862
        s 7 1270 862
        m 0 167 862
        m 1 500 862
        m 2 700 862
        m 3 900 862

Make a copy of V56 template file from "V56PPTTemplate" for V56SMCLK1270M900V862PP75HX

    $ cp V56PPTTemplate V56SMCLK1270M900V862PP75HXTemplate

Just run the script to see the usage.
    
    $ ./generatePPTFromSMClk.sh
    ./generatePPTFromSMClk.sh SMClkFile CopyOfPPTTemplate PowerPercent

    Example: ./generatePPTFromSMClk.sh SMClkFile CopyOfPPTTemplate 125
    Do not use more than 100 percent of the PowerPercent if you do not know what you are doing...

In this example, PPT text file will be generated with 75% power on Vega 56 gpu.

    $ ./generatePPTFromSMClk.sh V56SMCLK1270M900V862PP75HX V56SMCLK1270M900V862PP75HXTemplate 75
    C0c0a0<->d04c01
    V0v0<->5e03
    C1c1a1<->1c8301
    V1v1<->5e03
    C2c2a2<->70a701
    V2v2<->5e03
    C3c3a3<->88bc01
    V3v3<->5e03
    C4c4a4<->289a01
    V4v4<->5e03
    C5c5a5<->88d501
    V5v5<->5e03
    C6c6a6<->70d901
    V6v6<->5e03
    C7c7a7<->18f001
    V7v7<->5e03
    M0m0a0<->3c4100
    I0i0<->0000 for 5e03 Index: 0
    M1m1a1<->50c300
    I1i1<->0000 for 5e03 Index: 0
    M2m2a2<->701101
    I2i2<->0000 for 5e03 Index: 0
    M3m3a3<->905f01
    I3i3<->0000 for 5e03 Index: 0
    PP<->4b

Now generate a PPT binary file with SoftPPT-1.0.0.jar.

    $ java -jar ./SoftPPT-1.0.0.jar V56SMCLK1270M900V862PP75HXTemplate V56PPT1270M900V862PP75HX 
    Converting Text PPT to Binary PPT...
    Successfully converted PPT to binary format.

The PPT file will be named V56PPT1270M900V862PP75HX1.  You may name it to anything you want.

Example: mv V56PPT1270M900V862PP75HX1 V56PPTForETHRig

Now you have a binary ppt file that you can use.  Set the new PPT values to GPU0.

    $ ./setPPT.sh 0 V56PPTForETHRig

The fans will stop running after PPT is set.  Don't forget to restart the fans. 

    $ ./setAMDGPUFanSpeed.sh -g 0 -s 65 



CONTENTS

    generatePPTFromSMClk.sh    - The "bash" script to generate PPT text file.
    README.md                  - This file.
    V56PPTTemplate             - Vega 56 template file.
    V64PPTTemplate             - Vega 64 template file.
    V56SMCLK1270M900V862PP75HX - Sample SMClock file with core P7 1270, mem P3 900 and 862 mV for all P states with 75 % power percent. 

MD5 file checksums:
1. 5ab9af0f40ee8d19f784ff3b8c528d6f  V56PPTTemplate
2. d3a7848c3423898a5462bf747cacb709  V64PPTTemplate
